```python
# app.py
import os
import sqlite3
import secrets
import hashlib
from datetime import datetime, timedelta
from flask import (
    Flask,
    render_template,
    request,
    redirect,
    url_for,
    session,
    g,
    flash,
    make_response,
)
from werkzeug.security import generate_password_hash, check_password_hash

# --- App Configuration ---
app = Flask(__name__)
app.config.from_mapping(
    SECRET_KEY=secrets.token_hex(16),
    DATABASE=os.path.join(app.instance_path, "app.db"),
    REMEMBER_COOKIE_NAME="remember_token",
    REMEMBER_COOKIE_DURATION=timedelta(days=30),
)

# Ensure the instance folder exists
try:
    os.makedirs(app.instance_path)
except OSError:
    pass


# --- Database Setup ---
def get_db():
    if "db" not in g:
        g.db = sqlite3.connect(
            app.config["DATABASE"], detect_types=sqlite3.PARSE_DECLTYPES
        )
        g.db.row_factory = sqlite3.Row
    return g.db


@app.teardown_appcontext
def close_db(e=None):
    db = g.pop("db", None)
    if db is not None:
        db.close()


def init_db():
    db = get_db()
    with app.open_resource("schema.sql") as f:
        db.executescript(f.read().decode("utf8"))


@app.cli.command("init-db")
def init_db_command():
    """Clear the existing data and create new tables."""
    init_db()
    click.echo("Initialized the database.")


import click


@app.cli.command("create-user")
@click.argument("username")
@click.argument("password")
def create_user_command(username, password):
    """Create a new user."""
    db = get_db()
    try:
        db.execute(
            "INSERT INTO users (username, password_hash) VALUES (?, ?)",
            (username, generate_password_hash(password)),
        )
        db.commit()
        click.echo(f"User {username} created successfully.")
    except sqlite3.IntegrityError:
        click.echo(f"Error: User {username} already exists.")


# --- User and Token Models ---
def get_user_by_id(user_id):
    return get_db().execute("SELECT * FROM users WHERE id = ?", (user_id,)).fetchone()


def get_user_by_username(username):
    return (
        get_db().execute("SELECT * FROM users WHERE username = ?", (username,)).fetchone()
    )


def get_token_by_selector(selector):
    return (
        get_db()
        .execute("SELECT * FROM auth_tokens WHERE selector = ?", (selector,))
        .fetchone()
    )


def create_auth_token(user_id):
    selector = secrets.token_urlsafe(16)
    validator = secrets.token_urlsafe(32)
    validator_hash = hashlib.sha256(validator.encode("utf-8")).hexdigest()

    expires = datetime.utcnow() + app.config["REMEMBER_COOKIE_DURATION"]

    db = get_db()
    db.execute(
        """
        INSERT INTO auth_tokens (user_id, selector, validator_hash, expires)
        VALUES (?, ?, ?, ?)
        """,
        (user_id, selector, validator_hash, expires),
    )
    db.commit()

    return f"{selector}:{validator}"


def delete_token(selector):
    db = get_db()
    db.execute("DELETE FROM auth_tokens WHERE selector = ?", (selector,))
    db.commit()


# --- Hooks and Authentication Logic ---
@app.before_request
def load_logged_in_user():
    user_id = session.get("user_id")

    if user_id is None:
        # Check for remember me cookie
        token_cookie = request.cookies.get(app.config["REMEMBER_COOKIE_NAME"])
        if token_cookie:
            g.user = login_via_remember_cookie(token_cookie)
        else:
            g.user = None
    else:
        g.user = get_user_by_id(user_id)


def login_via_remember_cookie(token_cookie):
    try:
        selector, validator = token_cookie.split(":")
    except ValueError:
        return None

    token_data = get_token_by_selector(selector)

    if not token_data:
        return None

    if token_data["expires"] < datetime.utcnow():
        delete_token(selector)
        return None

    validator_hash = hashlib.sha256(validator.encode("utf-8")).hexdigest()
    if not secrets.compare_digest(validator_hash, token_data["validator_hash"]):
        delete_token(selector)
        return None

    user = get_user_by_id(token_data["user_id"])
    if user:
        session["user_id"] = user["id"]
        return user

    return None


# --- Routes ---
@app.route("/")
def index():
    return render_template("index.html")


@app.route("/login", methods=("GET", "POST"))
def login():
    if g.user:
        return redirect(url_for("profile"))

    if request.method == "POST":
        username = request.form["username"]
        password = request.form["password"]
        remember_me = "remember" in request.form

        error = None
        user = get_user_by_username(username)

        if user is None or not check_password_hash(user["password_hash"], password):
            error = "Incorrect username or password."
        
        if error is None:
            session.clear()
            session["user_id"] = user["id"]
            
            response = make_response(redirect(url_for("profile")))
            
            if remember_me:
                token = create_auth_token(user["id"])
                response.set_cookie(
                    app.config["REMEMBER_COOKIE_NAME"],
                    value=token,
                    max_age=app.config["REMEMBER_COOKIE_DURATION"],
                    httponly=True,
                    samesite='Lax'
                )
            
            flash("You were successfully logged in.", "success")
            return response

        flash(error, "error")

    return render_template("login.html")


@app.route("/profile")
def profile():
    if not g.user:
        return redirect(url_for("login"))
    return render_template("profile.html")


@app.route("/logout")
def logout():
    session.clear()
    response = make_response(redirect(url_for("index")))
    
    token_cookie = request.cookies.get(app.config["REMEMBER_COOKIE_NAME"])
    if token_cookie:
        try:
            selector, _ = token_cookie.split(":")
            delete_token(selector)
        except ValueError:
            pass # Malformed cookie, ignore
        response.delete_cookie(app.config["REMEMBER_COOKIE_NAME"])

    flash("You have been logged out.", "info")
    return response


if __name__ == "__main__":
    app.run(debug=True)
```

```sql
-- schema.sql
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS auth_tokens;

CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL
);

CREATE TABLE auth_tokens (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    selector TEXT UNIQUE NOT NULL,
    validator_hash TEXT NOT NULL,
    expires TIMESTAMP NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE
);
```

```html
<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Remember Me App{% endblock %}</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 2rem auto; padding: 0 1rem; background-color: #fdfdfd; }
        nav { background-color: #f0f0f0; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; }
        nav ul { list-style-type: none; padding: 0; margin: 0; display: flex; gap: 1rem; }
        nav a { text-decoration: none; color: #007bff; font-weight: 500; }
        nav a:hover { text-decoration: underline; }
        .flash { padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid transparent; }
        .flash.success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
        .flash.error { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }
        .flash.info { color: #0c5460; background-color: #d1ecf1; border-color: #bee5eb; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; }
        .form-group input[type="text"], .form-group input[type="password"] { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .form-group-checkbox { display: flex; align-items: center; gap: 0.5rem; }
        .btn { background-color: #007bff; color: white; padding: 0.6rem 1.2rem; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; }
        .btn:hover { background-color: #0056b3; }
        h1, h2 { color: #444; }
    </style>
</head>
<body>
    <nav>
        <ul>
            <li><a href="{{ url_for('index') }}">Home</a></li>
            {% if g.user %}
                <li><a href="{{ url_for('profile') }}">Profile</a></li>
                <li><a href="{{ url_for('logout') }}">Logout</a></li>
            {% else %}
                <li><a href="{{ url_for('login') }}">Login</a></li>
            {% endif %}
        </ul>
    </nav>

    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>
</body>
</html>
```

```html
<!-- templates/index.html -->
{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
    <h1>Welcome to the Flask Remember Me Demo</h1>
    {% if g.user %}
        <p>You are logged in as <strong>{{ g.user.username }}</strong>.</p>
        <p>Try closing your browser and reopening this page. You should remain logged in.</p>
    {% else %}
        <p>You are not logged in.</p>
        <p>Please <a href="{{ url_for('login') }}">log in</a> to continue.</p>
    {% endif %}
{% endblock %}
```

```html
<!-- templates/login.html -->
{% extends 'base.html' %}

{% block title %}Login{% endblock %}

{% block content %}
    <h2>Login</h2>
    <form method="post">
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" name="username" id="username" required>
        </div>
        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" name="password" id="password" required>
        </div>
        <div class="form-group form-group-checkbox">
            <input type="checkbox" name="remember" id="remember">
            <label for="remember">Remember me</label>
        </div>
        <button type="submit" class="btn">Login</button>
    </form>
{% endblock %}
```

```html
<!-- templates/profile.html -->
{% extends 'base.html' %}

{% block title %}Profile{% endblock %}

{% block content %}
    <h2>User Profile</h2>
    <p>Hello, <strong>{{ g.user.username }}</strong>!</p>
    <p>This is a protected page, only visible to logged-in users.</p>
{% endblock %}
```