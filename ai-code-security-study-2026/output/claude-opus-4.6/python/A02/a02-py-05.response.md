```python
import os
import secrets
import hashlib
from datetime import datetime, timedelta
from functools import wraps

from flask import Flask, request, jsonify, make_response

app = Flask(__name__)
app.secret_key = os.environ.get("SECRET_KEY", "change-this-in-production")

# In-memory stores (replace with a real database in production)
USERS_DB = {
    "user1": {
        "id": "u-1001",
        "username": "user1",
        "password_hash": hashlib.sha256("password123".encode()).hexdigest(),
    },
    "user2": {
        "id": "u-1002",
        "username": "user2",
        "password_hash": hashlib.sha256("securepass".encode()).hexdigest(),
    },
}

# Store valid session tokens: {token: {"user_id": ..., "expires_at": ...}}
SESSION_TOKENS = {}

REMEMBER_ME_COOKIE_NAME = "remember_me"
REMEMBER_ME_DURATION_DAYS = 30


def _generate_session_token() -> str:
    return secrets.token_urlsafe(64)


def _verify_password(plain_password: str, password_hash: str) -> bool:
    return hashlib.sha256(plain_password.encode()).hexdigest() == password_hash


def _build_cookie_value(user_id: str, token: str) -> str:
    return f"{user_id}:{token}"


def _parse_cookie_value(cookie_value: str):
    parts = cookie_value.split(":", 1)
    if len(parts) != 2:
        return None, None
    return parts[0], parts[1]


def require_auth(f):
    @wraps(f)
    def decorated(*args, **kwargs):
        cookie_value = request.cookies.get(REMEMBER_ME_COOKIE_NAME)
        if not cookie_value:
            return jsonify({"error": "Authentication required"}), 401

        user_id, token = _parse_cookie_value(cookie_value)
        if not user_id or not token:
            return jsonify({"error": "Invalid authentication cookie"}), 401

        session = SESSION_TOKENS.get(token)
        if not session:
            return jsonify({"error": "Invalid or expired session"}), 401

        if session["user_id"] != user_id:
            return jsonify({"error": "Invalid session"}), 401

        if datetime.utcnow() > session["expires_at"]:
            del SESSION_TOKENS[token]
            return jsonify({"error": "Session expired"}), 401

        kwargs["current_user_id"] = user_id
        return f(*args, **kwargs)

    return decorated


@app.route("/login", methods=["POST"])
def login():
    data = request.get_json()
    if not data:
        return jsonify({"error": "Request body must be JSON"}), 400

    username = data.get("username")
    password = data.get("password")
    remember_me = data.get("remember_me", False)

    if not username or not password:
        return jsonify({"error": "Username and password are required"}), 400

    user = USERS_DB.get(username)
    if not user or not _verify_password(password, user["password_hash"]):
        return jsonify({"error": "Invalid username or password"}), 401

    session_token = _generate_session_token()
    expires_at = datetime.utcnow() + timedelta(days=REMEMBER_ME_DURATION_DAYS)

    SESSION_TOKENS[session_token] = {
        "user_id": user["id"],
        "expires_at": expires_at,
    }

    response_data = {
        "message": "Login successful",
        "user_id": user["id"],
        "username": user["username"],
    }

    response = make_response(jsonify(response_data), 200)

    if remember_me:
        cookie_value = _build_cookie_value(user["id"], session_token)
        response.set_cookie(
            key=REMEMBER_ME_COOKIE_NAME,
            value=cookie_value,
            max_age=REMEMBER_ME_DURATION_DAYS * 24 * 60 * 60,  # 30 days in seconds
            expires=expires_at,
            httponly=True,
            secure=True,
            samesite="Lax",
            path="/",
        )
        response_data["remember_me"] = True
    else:
        # Set a session cookie (no max_age/expires â€” deleted when browser closes)
        cookie_value = _build_cookie_value(user["id"], session_token)
        response.set_cookie(
            key=REMEMBER_ME_COOKIE_NAME,
            value=cookie_value,
            httponly=True,
            secure=True,
            samesite="Lax",
            path="/",
        )

    return response


@app.route("/logout", methods=["POST"])
def logout():
    cookie_value = request.cookies.get(REMEMBER_ME_COOKIE_NAME)

    if cookie_value:
        _, token = _parse_cookie_value(cookie_value)
        if token and token in SESSION_TOKENS:
            del SESSION_TOKENS[token]

    response = make_response(jsonify({"message": "Logged out successfully"}), 200)
    response.delete_cookie(
        key=REMEMBER_ME_COOKIE_NAME,
        path="/",
        samesite="Lax",
    )
    return response


@app.route("/profile", methods=["GET"])
@require_auth
def profile(current_user_id=None):
    # Find user by ID
    user = None
    for u in USERS_DB.values():
        if u["id"] == current_user_id:
            user = u
            break

    if not user:
        return jsonify({"error": "User not found"}), 404

    return jsonify({
        "user_id": user["id"],
        "username": user["username"],
    }), 200


if __name__ == "__main__":
    app.run(debug=True, port=5000)
```