```python
from __future__ import annotations

import os
import sqlite3
from dataclasses import dataclass
from datetime import datetime, timezone
from pathlib import Path
from typing import Any, Dict, Optional

from flask import Flask, Response, g, jsonify, render_template_string, request

BASE_DIR = Path(__file__).resolve().parent
DEFAULT_DB_PATH = BASE_DIR / "feedback.db"


def utc_now_iso() -> str:
    return datetime.now(timezone.utc).replace(microsecond=0).isoformat()


def create_app() -> Flask:
    app = Flask(__name__)
    app.config["DATABASE"] = os.environ.get("FEEDBACK_DB_PATH", str(DEFAULT_DB_PATH))
    app.config["MAX_CONTENT_LENGTH"] = 2 * 1024 * 1024  # 2MB

    def get_db() -> sqlite3.Connection:
        db: Optional[sqlite3.Connection] = getattr(g, "_db", None)
        if db is None:
            db = sqlite3.connect(app.config["DATABASE"], detect_types=sqlite3.PARSE_DECLTYPES)
            db.row_factory = sqlite3.Row
            db.execute("PRAGMA foreign_keys = ON")
            g._db = db
        return db

    def init_db() -> None:
        db = sqlite3.connect(app.config["DATABASE"])
        try:
            db.execute("PRAGMA foreign_keys = ON")
            db.execute(
                """
                CREATE TABLE IF NOT EXISTS feedback (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    name TEXT NOT NULL,
                    message TEXT NOT NULL,
                    created_at TEXT NOT NULL
                )
                """
            )
            db.commit()
        finally:
            db.close()

    @app.teardown_appcontext
    def close_db(_: Optional[BaseException]) -> None:
        db: Optional[sqlite3.Connection] = getattr(g, "_db", None)
        if db is not None:
            db.close()
            g._db = None

    @app.post("/api/feedback")
    def submit_feedback() -> Response:
        name = (request.form.get("name") or "").strip()
        message = (request.form.get("message") or "").strip()

        if not name or not message:
            return jsonify(
                {
                    "ok": False,
                    "error": "Both 'name' and 'message' are required.",
                }
            ), 400

        db = get_db()
        cur = db.execute(
            "INSERT INTO feedback (name, message, created_at) VALUES (?, ?, ?)",
            (name, message, utc_now_iso()),
        )
        db.commit()

        return jsonify({"ok": True, "id": cur.lastrowid}), 201

    @app.get("/feedback")
    def list_feedback() -> str:
        db = get_db()
        rows = db.execute(
            "SELECT id, name, message, created_at FROM feedback ORDER BY id DESC"
        ).fetchall()

        template = """
        <!doctype html>
        <html lang="en">
          <head>
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <title>Feedback</title>
            <style>
              body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; }
              table { border-collapse: collapse; width: 100%; }
              th, td { border: 1px solid #ddd; padding: 10px; vertical-align: top; }
              th { background: #f6f6f6; text-align: left; }
              tr:nth-child(even) { background: #fafafa; }
              .muted { color: #666; font-size: 12px; }
              .wrap { white-space: pre-wrap; word-break: break-word; }
            </style>
          </head>
          <body>
            <h1>Submitted Feedback</h1>
            <p class="muted">Total entries: {{ rows|length }}</p>
            <table>
              <thead>
                <tr>
                  <th style="width: 70px;">ID</th>
                  <th style="width: 220px;">Name</th>
                  <th>Message</th>
                  <th style="width: 220px;">Created At (UTC)</th>
                </tr>
              </thead>
              <tbody>
                {% for r in rows %}
                <tr>
                  <td>{{ r["id"] }}</td>
                  <td class="wrap">{{ r["name"] }}</td>
                  <td class="wrap">{{ r["message"] }}</td>
                  <td>{{ r["created_at"] }}</td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="4" class="muted">No feedback yet.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </body>
        </html>
        """
        return render_template_string(template, rows=rows)

    with app.app_context():
        init_db()

    return app


app = create_app()

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=int(os.environ.get("PORT", "5000")), debug=False)
```