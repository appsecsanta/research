```python
import os
import sqlite3
from contextlib import closing
from datetime import datetime, timezone

from flask import (
    Flask,
    abort,
    g,
    redirect,
    render_template_string,
    request,
    url_for,
)

SCHEMA_SQL = """
PRAGMA journal_mode = WAL;
PRAGMA foreign_keys = ON;

CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    email TEXT NOT NULL UNIQUE,
    name TEXT,
    created_at TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS audit_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    action TEXT NOT NULL,
    user_id INTEGER,
    meta TEXT,
    created_at TEXT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS site_counters (
    key TEXT PRIMARY KEY,
    value INTEGER NOT NULL
);

INSERT OR IGNORE INTO site_counters(key, value) VALUES ('users_deleted', 0);
"""

USERS_TEMPLATE = """
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Admin - Users</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    nav a { margin-right: 12px; }
    table { border-collapse: collapse; width: 100%; margin-top: 16px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    th { background: #f5f5f5; }
    form { margin: 0; }
    .muted { color: #666; font-size: 0.9rem; }
    .danger { background: #b00020; color: white; border: none; padding: 8px 10px; cursor: pointer; border-radius: 4px; }
    .danger:hover { filter: brightness(0.95); }
    .container { max-width: 1100px; margin: 0 auto; }
  </style>
</head>
<body>
<div class="container">
  <nav>
    <a href="{{ url_for('admin_users') }}">Users</a>
    <a href="{{ url_for('admin_stats') }}">Stats</a>
  </nav>

  <h1>Users</h1>
  <p class="muted">Total: {{ users|length }}</p>

  <table>
    <thead>
      <tr>
        <th style="width: 80px;">ID</th>
        <th>Email</th>
        <th>Name</th>
        <th style="width: 220px;">Created</th>
        <th style="width: 140px;">Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for u in users %}
      <tr>
        <td>{{ u["id"] }}</td>
        <td>{{ u["email"] }}</td>
        <td>{{ u["name"] or "" }}</td>
        <td>{{ u["created_at"] }}</td>
        <td>
          <form method="post" action="{{ url_for('admin_user_delete', user_id=u['id']) }}"
                onsubmit="return confirm('Delete user #{{ u['id'] }} ({{ u['email'] }})?');">
            <button class="danger" type="submit">Delete</button>
          </form>
        </td>
      </tr>
    {% endfor %}
    {% if not users %}
      <tr><td colspan="5" class="muted">No users found.</td></tr>
    {% endif %}
    </tbody>
  </table>
</div>
</body>
</html>
"""

STATS_TEMPLATE = """
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Admin - Stats</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    nav a { margin-right: 12px; }
    .container { max-width: 900px; margin: 0 auto; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px; }
    .card { border: 1px solid #ddd; border-radius: 8px; padding: 14px; background: #fff; }
    .label { color: #666; font-size: 0.9rem; }
    .value { font-size: 1.6rem; font-weight: 600; margin-top: 6px; }
    .muted { color: #666; font-size: 0.9rem; margin-top: 16px; }
  </style>
</head>
<body>
<div class="container">
  <nav>
    <a href="{{ url_for('admin_users') }}">Users</a>
    <a href="{{ url_for('admin_stats') }}">Stats</a>
  </nav>

  <h1>Site Statistics</h1>

  <div class="grid">
    <div class="card">
      <div class="label">Total users</div>
      <div class="value">{{ stats.total_users }}</div>
    </div>
    <div class="card">
      <div class="label">Users deleted (all time)</div>
      <div class="value">{{ stats.users_deleted }}</div>
    </div>
    <div class="card">
      <div class="label">Last user created</div>
      <div class="value" style="font-size: 1.1rem; font-weight: 500;">{{ stats.last_user_created or "â€”" }}</div>
    </div>
    <div class="card">
      <div class="label">Delete events logged</div>
      <div class="value">{{ stats.delete_events }}</div>
    </div>
  </div>

  <p class="muted">Generated at {{ stats.generated_at }}</p>
</div>
</body>
</html>
"""


def utc_now_iso() -> str:
    return datetime.now(timezone.utc).replace(microsecond=0).isoformat()


def create_app() -> Flask:
    app = Flask(__name__)

    instance_path = app.instance_path
    os.makedirs(instance_path, exist_ok=True)
    app.config.setdefault("DATABASE", os.path.join(instance_path, "app.sqlite3"))

    def get_db() -> sqlite3.Connection:
        db = g.get("db")
        if db is None:
            db = sqlite3.connect(
                app.config["DATABASE"],
                detect_types=sqlite3.PARSE_DECLTYPES,
                check_same_thread=False,
            )
            db.row_factory = sqlite3.Row
            db.execute("PRAGMA foreign_keys = ON;")
            g.db = db
        return db

    def init_db() -> None:
        db = sqlite3.connect(app.config["DATABASE"], check_same_thread=False)
        try:
            db.row_factory = sqlite3.Row
            with closing(db.cursor()) as cur:
                cur.executescript(SCHEMA_SQL)
            db.commit()
        finally:
            db.close()

    def counter_increment(key: str, delta: int = 1) -> None:
        db = get_db()
        db.execute(
            """
            INSERT INTO site_counters(key, value) VALUES (?, ?)
            ON CONFLICT(key) DO UPDATE SET value = value + excluded.value
            """,
            (key, delta),
        )

    @app.teardown_appcontext
    def close_db(_exc: Exception | None) -> None:
        db = g.pop("db", None)
        if db is not None:
            db.close()

    with app.app_context():
        init_db()

    @app.get("/admin/users")
    def admin_users():
        db = get_db()
        users = db.execute(
            "SELECT id, email, name, created_at FROM users ORDER BY id DESC"
        ).fetchall()
        return render_template_string(USERS_TEMPLATE, users=users)

    @app.post("/admin/users/<int:user_id>/delete")
    def admin_user_delete(user_id: int):
        db = get_db()
        with db:
            user = db.execute(
                "SELECT id, email, name, created_at FROM users WHERE id = ?",
                (user_id,),
            ).fetchone()
            if user is None:
                abort(404, description="User not found")

            db.execute("DELETE FROM users WHERE id = ?", (user_id,))
            db.execute(
                "INSERT INTO audit_log(action, user_id, meta, created_at) VALUES (?, ?, ?, ?)",
                ("user_deleted", user_id, f'{{"email": "{user["email"]}"}}', utc_now_iso()),
            )
            counter_increment("users_deleted", 1)

        return redirect(url_for("admin_users"))

    @app.get("/admin/stats")
    def admin_stats():
        db = get_db()
        total_users = db.execute("SELECT COUNT(*) AS c FROM users").fetchone()["c"]
        users_deleted = db.execute(
            "SELECT value FROM site_counters WHERE key = ?",
            ("users_deleted",),
        ).fetchone()
        users_deleted_value = int(users_deleted["value"]) if users_deleted else 0

        last_user_created = db.execute(
            "SELECT created_at FROM users ORDER BY id DESC LIMIT 1"
        ).fetchone()
        last_user_created_value = last_user_created["created_at"] if last_user_created else None

        delete_events = db.execute(
            "SELECT COUNT(*) AS c FROM audit_log WHERE action = ?",
            ("user_deleted",),
        ).fetchone()["c"]

        stats = {
            "total_users": total_users,
            "users_deleted": users_deleted_value,
            "last_user_created": last_user_created_value,
            "delete_events": delete_events,
            "generated_at": utc_now_iso(),
        }
        return render_template_string(STATS_TEMPLATE, stats=stats)

    return app


app = create_app()

if __name__ == "__main__":
    app.run(host="127.0.0.1", port=int(os.environ.get("PORT", "5000")), debug=False)
```